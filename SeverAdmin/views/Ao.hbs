<section id="container">
    <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="index.html" class="logo"><b>QV Shop</b></a>
        <!--logo end-->

        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="/logout">Logout</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->

    <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">

                <p class="centered"><a href="profile.html"><img src="assets/img/avatar.jpg" class="img-circle"
                            width="50"></a></p>
                <h5 class="centered">lâm Quốc Việt</h5>
                <li class="sub-menu">
                    <a href="/index">
                        <i class="fa fa-bar-chart-o"></i>
                        <span>Thống kê</span>
                    </a>

                </li>
                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa li_shop"></i>
                        <span>Quản lý sản phẩm</span>
                    </a>
                    <ul class="sub">
                        <li><a class="li_t-shirt" href="/Ao"> Áo</a></li>
                        <li><a class="li_t-socks" href="/Quan">Quần</a></li>
                    </ul>
                </li>

                <li class="sub-menu">
                    <a href="/KhacHhang">
                        <i class="li_user"></i>
                        <span>Quản lý khách hàng</span>
                    </a>

                </li>

                <li class="sub-menu">
                    <a href="/thongtin">
                        <i class="fa fa-cogs"></i>
                        <span>Thông tin Admin</span>
                    </a>
                </li>



            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <section id="main-content">
        <section class="wrapper">


            <div class="row mt">
                <div class="col-md-12">
                    <div class="content-panel">
                        <table class="table table-striped table-advance table-hover">
                            <h4><i class="fa li_t-shirt"></i> QUẢN LÝ SẢN PHẨM ÁO</h4>
                            <hr>
                            <thead>
                                <div class="pagging">
                                    <div class="col-sm-2 container"> <button
                                            class="btn btn-success btn-block mb-5 li_add"
                                            onclick="confirmAddModal('')">Thêm Sản Phẩm</button> </div>
                                    <div class="right">
                                        <label>Tìm kiếm sản phẩm: </label>
                                        <input type="text" class="field small-field" />
                                        <input type="submit" class="button" value="search" />
                                    </div>
                                </div>
                                <tr>
                                    <th><i class="fa fa-key"></i> ID</th>
                                    <th class="hidden-phone"><i class="fa fa-pencil"></i> Tên Sản Phẩm</th>
                                    <th><i class=" fa fa-money"></i> Giá Sản Phẩm</th>
                                    <th><i class="fa li_note"></i> Số Lượng</th>
                                    <th><i class="fa li_note"></i> Hình Ảnh</th>
                                    <th><i class="fa li_note"></i> Ngày Sản Xuất</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each ao}}
                                <tr>
                                    <td>{{Num @index}}</td>
                                    <td class="hidden-phone">{{this.name}}</td>
                                    <td>{{this.price}}</td>
                                    <td>{{this.amount}} </td>
                                    <td>{{formatDate this.date 1}} </td>
                                    <td><img src="{{this.avatar}}" width="50" height="50"></img> </td>
                                    <td>
                                        <button class="btn btn-primary btn-xs" onclick="onEdit('{{this._id}}')"><i
                                                class="fa fa-pencil"></i></button>
                                        <button onclick="onDelete('{{this._id}}')" class="btn btn-danger btn-xs"><i
                                                class="fa fa-trash-o "></i></button>
                                    </td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                        <div class="pagging">
                            <div class="left">Showing 1-12 of 44</div>
                            <div class="right"> <a href="#">Previous</a> <a href="#">1</a> <a href="#">2</a> <a
                                    href="#">3</a> <a href="#">4</a> <a href="#">245</a> <span>...</span> <a
                                    href="#">Next</a> <a href="#">View all</a> </div>
                        </div>
                    </div><!-- /content-panel -->
                </div><!-- /col-md-12 -->
            </div><!-- /row -->

        </section>
        <!--/wrapper -->
    </section><!-- /MAIN CONTENT -->
    <section id="main-content">
        <section class="wrapper">
            <footer class="site-footer">
                <div class="text-center">
                    2021 - Alvarez.is
                    <a href="index.html#" class="go-top">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>
            </footer>
            <!--footer end-->
        </section>

        <!--delete-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <!--Add-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <script type="text/javascript">

            function confirmAddModal() {
                $('#Addmodal').modal();
                $('#AddButton').html('<a class="btn btn-danger" >Lưu Sản Phẩm</a>');
            }
            function deleteData(id) {
                // do your stuffs with id
            }
        </script>
        <!--modal delete starts here--->
        <div id="deleteModal" class="modal fade" role='dialog'>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Xóa Sản Phẩm </h4>
                    </div>
                    <div class="modal-body">
                        <p>Bạn có chắc muốn xóa sản phẩm này ?</p>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                        <span id='deleteButton'></span>
                    </div>
                </div>
            </div>
        </div>
        <!--Modal delete ends here--->
        <!----modal Add starts here--->
        <script src=" https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
        <div id="Addmodal" class="modal fade" role='dialog'>
            <div class="modal-dialog">
                <div class="modal-content">
                    <form role="form" action="/Ao/insert" method="POST">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">Thêm Sản Phẩm </h4>
                        </div>
                        <div class="modal-body">
                            <label for="exampleFormControlInput1">Tên Sản Phẩm</label>
                            <input id="name" onchange="validateName()" type="name" name="name" class="form-control"
                                id="exampleFormControlInput1"><br>
                            <label for="exampleFormControlInput1">Ngày Sản Xuất</label>
                            <input id="date" value="{{formatDate ao.date 0}}" type="date" name="date"
                                class="form-control" id="exampleFormControlInput1"><br>
                            <label for="exampleFormControlInput1">Giá Sản Phẩm</label>
                            <input id="price" onchange="validatePrice()" type="name" name="price"
                                class="form-control"><br>

                            <label for="exampleFormControlInput1">Số Lượng</label>
                            <input id="amount" onchange="validateSL()" type="name" name="amount"
                                class="form-control"><br>


                            <label for="exampleFormControlFile1">Hình Ảnh Sản Phẩm</label><br>
                            <img src="{{ao.avatar}}" id="products-avart" width="150" height="150"></img>
                            <input onchange="onchangeImg()" id="img" type="file" name="avatar"
                                class="form-control-file">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                            <button class="btn btn-default" onchange="validateForm()" type="submit">Thêm</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--Modal Add ends here--->
        <!-- js placed at the end of the document so the pages load faster -->
        <script src="assets/js/jquery.js"></script>
        <script src="assets/js/jquery-1.8.3.min.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
        <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
        <script src="assets/js/jquery.scrollTo.min.js"></script>
        <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>
        <script src="assets/js/jquery.sparkline.js"></script>


        <!--common script for all pages-->
        <script src="assets/js/common-scripts.js"></script>

        <script type="text/javascript" src="assets/js/gritter/js/jquery.gritter.js"></script>
        <script type="text/javascript" src="assets/js/gritter-conf.js"></script>

        <!--script for this page-->
        <script src="assets/js/sparkline-chart.js"></script>
        <script src="assets/js/zabuto_calendar.js"></script>



        <script type="application/javascript">
            $(document).ready(function () {
                $("#date-popover").popover({ html: true, trigger: "manual" });
                $("#date-popover").hide();
                $("#date-popover").click(function (e) {
                    $(this).hide();
                });

                $("#my-calendar").zabuto_calendar({
                    action: function () {
                        return myDateFunction(this.id, false);
                    },
                    action_nav: function () {
                        return myNavFunction(this.id);
                    },
                    ajax: {
                        url: "show_data.php?action=1",
                        modal: true
                    },
                    legend: [
                        { type: "text", label: "Special event", badge: "00" },
                        { type: "block", label: "Regular event", }
                    ]
                });
            });


            function myNavFunction(id) {
                $("#date-popover").hide();
                var nav = $("#" + id).data("navigation");
                var to = $("#" + id).data("to");
                console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
            }
        </script>

        <script type="text/javascript" src="assets/js/jquery.backstretch.min.js"></script>
        <script>
            $.backstretch("assets/img/background.jpg", { speed: 500 });
        </script>

        <script>
            //cap nhat du lieu
            const onEdit = id => {
                window.location.href = '/Ao/edit/' + id
            }
        </script>


        <script>
            // xoa du lieu
            const onDelete = async (id) => {
                const url = 'http://localhost:2001/Ao/delete/' + id
                const option =
                {
                    method: 'delete',
                    headers:
                    {
                        'Content-Type': 'application/json'
                    }
                }
                try {
                    await fetchAPI(url, option)
                    window.location.href = '/Ao'
                } catch (e) {
                    console.log('delete error: ', e)
                }
            }

            const fetchAPI = async (url, option) => {
                const res = await fetch(url, option)
                return res.json()
            }
        </script>




        <script>
            //bat loi
            let isNameValid = isDatevalid = isPricevalid = isAmountvalid = false;
            const validateName = () => {
                let val = document.getElementById('name').value;
                if (!val || val.trim().length == 0) {
                    alert('không được bỏ trống')
                    isNameValid = false;
                }
                else {
                    isNameValid = true;
                }
                validateForm()
            }
            const valiDate = () => {
                let val = document.getElementById('date').value;
                let _date = new Date(val)
                let today = new Date()
                today.setHours(0, 0, 0, 0)
                if (!val || _date > today) {
                    alert('Chọn Sai Ngày Tháng')
                    isDatevalid = false;
                }
                else {
                    isDatevalid = true;
                }
                validateForm()
            }
            const validatePrice = () => {
                let val = document.getElementById('price').value;
                if (isNaN(val)) {
                    alert('chỉ được nhập số')
                    isPricevalid = false;
                }
                else if (val.trim().length == 0) {
                    alert('không được bỏ trống')
                    isPricevalid = false;
                }
                else {
                    isPricevalid = true;
                }
                validateForm()
            }
            const validateSL = () => {
                let val = document.getElementById('amount').value;
                if (isNaN(val)) {
                    alert('chỉ được nhập số')
                    isAmountvalid = false;
                }
                else if (val.trim().length == 0) {
                    alert('không được bỏ trống')
                    isAmountvalid = false;
                }
                else {
                    isAmountvalid = true;
                }
                validateForm()
            }
            const validateForm = () => {
                if (!isNameValid && !isDatevalid && !isPricevalid && !isAmountvalid) {
                    document.getElementById('submit').disabled = true
                }
                else {
                    document.getElementById('submit').disabled = false
                }
            }
            const firebaseConfig = {
                apiKey: "AIzaSyDJT4tSjHTDq4dlah3NDhgHOwW04fE6nMg",
                authDomain: "reactnews07jun2021.firebaseapp.com",
                projectId: "reactnews07jun2021",
                storageBucket: "reactnews07jun2021.appspot.com",
                messagingSenderId: "388418873645",
                appId: "1:388418873645:web:5c1f167def713531088ba4"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            //upload hinh
            const onchangeImg = () => {
                var file = document.getElementById('img').files[0];
                var reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('products-avart').src = e.target.result
                }
                reader.readAsDataURL(file)
                var storageRef = firebase.storage().ref(uuid());
                let uploadTask = storageRef.put(file);

                uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,
                    (snapshot) => { },
                    (error) => { console.log(error) },
                    () => {
                        uploadTask.snapshot.ref.getDownloadURL().then((url) => {
                            document.getElementById('avatar').value = url;
                            console.log(url)
                        })
                    }
                )
            }
            const uuid = () => {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            const getBase64 = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            }

            const uploadImg = (file) => {

                //doc hinh tu input

                getBase64(file).then(data => {
                    upload(data)
                })

            }

            const upload = async (data) => {
                const url = 'http://localhost:2001/Ao/delete/'
                const body = {
                    image: data
                }
                const option =
                {
                    method: 'post',
                    headers:
                    {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                }
                try {

                    const res = fetchAPI(url, option)
                } catch (e) {
                    console.log('Upload error: ', e)
                }
            }
        </script>